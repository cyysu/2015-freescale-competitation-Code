#include "5110.h"
 //液晶显示字符表
 const unsigned char font6x8[][6] =  
	{
  	{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },// sp
  	{ 0x00, 0x00, 0x00, 0x2f, 0x00, 0x00 },// !
  	{ 0x00, 0x00, 0x07, 0x00, 0x07, 0x00 },// "
  	{ 0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14 },// #
  	{ 0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12 },// $
  	{ 0x00, 0x62, 0x64, 0x08, 0x13, 0x23 },// %
  	{ 0x00, 0x36, 0x49, 0x55, 0x22, 0x50 },// &
  	{ 0x00, 0x00, 0x05, 0x03, 0x00, 0x00 },// '
  	{ 0x00, 0x00, 0x1c, 0x22, 0x41, 0x00 },// (
  	{ 0x00, 0x00, 0x41, 0x22, 0x1c, 0x00 },// )
  	{ 0x00, 0x14, 0x08, 0x3E, 0x08, 0x14 },// *
  	{ 0x00, 0x08, 0x08, 0x3E, 0x08, 0x08 },// +
  	{ 0x00, 0x00, 0x00, 0xA0, 0x60, 0x00 },// ,
  	{ 0x00, 0x08, 0x08, 0x08, 0x08, 0x08 },// -
  	{ 0x00, 0x00, 0x60, 0x60, 0x00, 0x00 },// .
  	{ 0x00, 0x20, 0x10, 0x08, 0x04, 0x02 },// /
  	{ 0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E },// 0
  	{ 0x00, 0x00, 0x42, 0x7F, 0x40, 0x00 },// 1
  	{ 0x00, 0x42, 0x61, 0x51, 0x49, 0x46 },// 2
  	{ 0x00, 0x21, 0x41, 0x45, 0x4B, 0x31 },// 3
  	{ 0x00, 0x18, 0x14, 0x12, 0x7F, 0x10 },// 4
  	{ 0x00, 0x27, 0x45, 0x45, 0x45, 0x39 },// 5
  	{ 0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30 },// 6
  	{ 0x00, 0x01, 0x71, 0x09, 0x05, 0x03 },// 7
  	{ 0x00, 0x36, 0x49, 0x49, 0x49, 0x36 },// 8
  	{ 0x00, 0x06, 0x49, 0x49, 0x29, 0x1E },// 9
  	{ 0x00, 0x00, 0x36, 0x36, 0x00, 0x00 },// :
  	{ 0x00, 0x00, 0x56, 0x36, 0x00, 0x00 },// ;
  	{ 0x00, 0x08, 0x14, 0x22, 0x41, 0x00 },// <
  	{ 0x00, 0x14, 0x14, 0x14, 0x14, 0x14 },// =
  	{ 0x00, 0x00, 0x41, 0x22, 0x14, 0x08 },// >
  	{ 0x00, 0x02, 0x01, 0x51, 0x09, 0x06 },// ?
  	{ 0x00, 0x32, 0x49, 0x59, 0x51, 0x3E },// @
  	{ 0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C },// A
  	{ 0x00, 0x7F, 0x49, 0x49, 0x49, 0x36 },// B
  	{ 0x00, 0x3E, 0x41, 0x41, 0x41, 0x22 },// C
  	{ 0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C },// D
  	{ 0x00, 0x7F, 0x49, 0x49, 0x49, 0x41 },// E
  	{ 0x00, 0x7F, 0x09, 0x09, 0x09, 0x01 },// F
  	{ 0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A },// G
  	{ 0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F },// H
  	{ 0x00, 0x00, 0x41, 0x7F, 0x41, 0x00 },// I
  	{ 0x00, 0x20, 0x40, 0x41, 0x3F, 0x01 },// J
  	{ 0x00, 0x7F, 0x08, 0x14, 0x22, 0x41 },// K
  	{ 0x00, 0x7F, 0x40, 0x40, 0x40, 0x40 },// L
  	{ 0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F },// M
  	{ 0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F },// N
  	{ 0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E },// O
  	{ 0x00, 0x7F, 0x09, 0x09, 0x09, 0x06 },// P
  	{ 0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E },// Q
  	{ 0x00, 0x7F, 0x09, 0x19, 0x29, 0x46 },// R
  	{ 0x00, 0x46, 0x49, 0x49, 0x49, 0x31 },// S
  	{ 0x00, 0x01, 0x01, 0x7F, 0x01, 0x01 },// T
  	{ 0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F },// U
  	{ 0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F },// V
  	{ 0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F },// W
  	{ 0x00, 0x63, 0x14, 0x08, 0x14, 0x63 },// X
  	{ 0x00, 0x07, 0x08, 0x70, 0x08, 0x07 },// Y
  	{ 0x00, 0x61, 0x51, 0x49, 0x45, 0x43 },// Z
  	{ 0x00, 0x00, 0x7F, 0x41, 0x41, 0x00 },// [
  	{ 0x00, 0x55, 0x2A, 0x55, 0x2A, 0x55 },// 55
  	{ 0x00, 0x00, 0x41, 0x41, 0x7F, 0x00 },// ]
  	{ 0x00, 0x04, 0x02, 0x01, 0x02, 0x04 },// ^
  	{ 0x00, 0x40, 0x40, 0x40, 0x40, 0x40 },// _
  	{ 0x00, 0x00, 0x01, 0x02, 0x04, 0x00 },// '
  	{ 0x00, 0x20, 0x54, 0x54, 0x54, 0x78 },// a
  	{ 0x00, 0x7F, 0x48, 0x44, 0x44, 0x38 },// b
  	{ 0x00, 0x38, 0x44, 0x44, 0x44, 0x20 },// c
  	{ 0x00, 0x38, 0x44, 0x44, 0x48, 0x7F },// d
  	{ 0x00, 0x38, 0x54, 0x54, 0x54, 0x18 },// e
  	{ 0x00, 0x08, 0x7E, 0x09, 0x01, 0x02 },// f
  	{ 0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C },// g
  	{ 0x00, 0x7F, 0x08, 0x04, 0x04, 0x78 },// h
  	{ 0x00, 0x00, 0x44, 0x7D, 0x40, 0x00 },// i
  	{ 0x00, 0x40, 0x80, 0x84, 0x7D, 0x00 },// j
  	{ 0x00, 0x7F, 0x10, 0x28, 0x44, 0x00 },// k
  	{ 0x00, 0x00, 0x41, 0x7F, 0x40, 0x00 },// l
  	{ 0x00, 0x7C, 0x04, 0x18, 0x04, 0x78 },// m
  	{ 0x00, 0x7C, 0x08, 0x04, 0x04, 0x78 },// n
  	{ 0x00, 0x38, 0x44, 0x44, 0x44, 0x38 },// o
  	{ 0x00, 0xFC, 0x24, 0x24, 0x24, 0x18 },// p
  	{ 0x00, 0x18, 0x24, 0x24, 0x18, 0xFC },// q
  	{ 0x00, 0x7C, 0x08, 0x04, 0x04, 0x08 },// r
  	{ 0x00, 0x48, 0x54, 0x54, 0x54, 0x20 },// s
  	{ 0x00, 0x04, 0x3F, 0x44, 0x40, 0x20 },// t
  	{ 0x00, 0x3C, 0x40, 0x40, 0x20, 0x7C },// u
  	{ 0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C },// v
  	{ 0x00, 0x3C, 0x40, 0x30, 0x40, 0x3C },// w
  	{ 0x00, 0x44, 0x28, 0x10, 0x28, 0x44 },// x
  	{ 0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C },// y
  	{ 0x00, 0x44, 0x64, 0x54, 0x4C, 0x44 },// z
  	{ 0x14, 0x14, 0x14, 0x14, 0x14, 0x14 }// horiz lines
	};

void nk5110_init()
{	
	LCD_init();
	LCD_clear();
	LCD_set_XY(0,0);
}
void Delay_ms(uint16 ms)      //延时一毫秒
{
    int ii,jj;
    if (ms<1) ms=1;
    for(ii=0;ii<ms;ii++)     
	   for(jj=0;jj<6676;jj++)
	   {
	   	
	   }
    //80MHz--1ms  
}  

/*********************************************************** 
函数名称：LCD_write_byte
函数功能：模拟SPI接口时序写数据/命令LCD
入口参数：Data    ：写入的数据；
          Command ：写数据/命令选择；
出口参数：无 
备 注： 
***********************************************************/

void LCD_write_byte(unsigned char Data, unsigned char Command)
{
    unsigned char i;
	LCD_CE_0; 	//CE=0	     //5110片选有效，允许输入数据
	
	if(Command==1)                     //DC=Command
	   	LCD_DC_1;
    else
    	LCD_DC_0;    
    
	for(i=0;i<8;i++)				     //传送8bit数据
	{ 
			if(Data&0x80)
			 	SDIN_1;
			else
			    SDIN_0;   
			
			Data = (Data <<1);
			SCLK_0; 
     
			SCLK_1;
			 
	}
     LCD_DC_1;           //	DC=1;
     LCD_CE_1; 			//CE=1;  
     SDIN_1;			// Din=1;
					  
}
/***********************************************************************/  
/*********************************************************** 
函数名称：LCD_init
函数功能：5110初始化
入口参数：无
出口参数：无 
备 注： 
***********************************************************/
void LCD_init(void)
{
   	LCD_RST_0;    // RST = 0;     // 产生一个让LCD复位的低电平脉冲
    Delay_ms(100);						
	LCD_RST_1;       //  RST = 1;
  	LCD_CE_1;  			// CE = 1;     // 关闭LCD
    Delay_ms(100);
  	LCD_CE_0;         // CE = 0;     // 使能LCD
    Delay_ms(100);

    LCD_write_byte(0x21, 0);	// 使用扩展命令设置LCD模式,水平寻址
    LCD_write_byte(0xb8, 0);	// 设置液晶偏置电压
    LCD_write_byte(0x06, 0);	// 温度校正
    LCD_write_byte(0x13, 0);	// 1:48
    LCD_write_byte(0x20, 0);
    	// 使用基本命令，V=0，水平寻址
    LCD_clear();	           // 清屏
    LCD_write_byte(0x0c, 0);	// 设定显示模式，正常显示
   
    LCD_CE_0;  	// CE = 0;      // 使能LCD
}

/*********************************************************** 
函数名称：LCD_set_XY
函数功能：设置LCD坐标函数
入口参数：X       ：0－83
          Y       ：0－5
出口参数：无 
备 注： 
***********************************************************/
void LCD_set_XY(unsigned char X, unsigned char Y)
{
    LCD_write_byte(0x40 | Y,0 );		  // column
    LCD_write_byte(0x80 | X,0 );          // row
}
 /*******************************************************************************************
函数名称：LCD_write_char
函数功能：显示英文字符
入口参数：c	:  显示的字符
出口参数：无 
备 注： 
***********************************************************/
void LCD_write_char(unsigned char c)
{
    unsigned char line;
    c -= 32;                       //数组的行号
  	LCD_CE_0;			//  CE=0;

    for (line=0; line<6; line++)
        LCD_write_byte(font6x8[c][line], 1);
}

//**********************************************************************************

void LCD_write_str(unsigned char *p)
{
	while(*p!='\0')
	{
		LCD_write_char(*p);
		p++;
	}
}

/*------------------------------------------ 
LCD_clear: LCD清屏函数  
--------------------------------------------*/ 
void LCD_clear(void) 
{ 
 unsigned char t; 
 unsigned char k; 
 LCD_set_XY(0,0); 
 for(t=0;t<6;t++) 
	  {  
		   for(k=0;k<84;k++) 
		   {  
		    LCD_write_byte(0x00,1);   
		   }  
	  } 
} 


/*********************************************************************/

  void LCD_write_1_num(unsigned char X,unsigned char Y,signed int s)
  {
     LCD_set_XY(X,Y);
     if(s<0)
     {
     	s=0-s;
     	LCD_write_char('-');
     }
     else
     {
       	LCD_write_char(' ');	
     }
	 LCD_write_char(s+0x30);	 
  }
  
   void LCD_write_2_num(unsigned char X,unsigned char Y,signed int s)
  {
     LCD_set_XY(X,Y);
     if(s<0)
     {
     	s=0-s;
     	LCD_write_char('-');
     }
     else
     {
       	LCD_write_char(' ');	
     }
	 LCD_write_char((s/10)+0x30);
	 LCD_write_char((s%10)+0x30);	 
  }
  
  void LCD_write_3_num(unsigned char X,unsigned char Y,signed int s)
  {   
     LCD_set_XY(X,Y);
     if(s<0)
     {
     	s=0-s;
     	LCD_write_char('-');
     }
     else
     {
       	LCD_write_char(' ');	
     }
	 LCD_write_char((s/100)+0x30);
	 LCD_write_char(((s%100)/10)+0x30);
	 LCD_write_char((s%10)+0x30);	 
  }
  
  void LCD_write_4_num(unsigned char X,unsigned char Y,int s)
  {
     LCD_set_XY(X,Y);
     if(s<0)
     {
     	s=0-s;
     	LCD_write_char('-');
     }
     else
     {
       	LCD_write_char(' ');	
     }
	 LCD_write_char((s/1000)+0x30);
	 LCD_write_char(((s%1000)/100)+0x30);
	 LCD_write_char(((s%100)/10)+0x30);
	 LCD_write_char((s%10)+0x30);	 
  }
  
/***********************************************************/
void LCD_draw_bmp_pixel(unsigned char X,unsigned char Y,unsigned char hhh,uint8*Image_,uint8 r)
{
    unsigned int i;
    signed int n;
    unsigned char *p;
    unsigned char CCD_temp[84];
    p=CCD_temp;
    for (n=0;n<155;n=n+2)
    {
        *p = (Image_[n+hhh*r]-254) +(Image_[n+(hhh+1)*r]-254)*2+ (Image_[n+(hhh+2)*r]-254)*4+ (Image_[n+(hhh+3)*r]-254)*8+
             (Image_[n+(hhh+4)*r]-254)*16+(Image_[n+(hhh+5)*r]-254)*32+(Image_[n+(hhh+6)*r]-254)*64+(Image_[n+(hhh+7)*r]-254)*128;    
        p++;
    }
    
    
   
        LCD_set_XY(X,Y);
        for(i=0; i<84; i++)
        {
            LCD_write_byte(~CCD_temp[i], 1);
        }
  
}

void show_lcd(uint8*I,uint8 C)
{
    LCD_draw_bmp_pixel(0,0, 0,I,C);    // 
    LCD_draw_bmp_pixel(0,1, 8,I,C);    // 
    LCD_draw_bmp_pixel(0,2,16,I,C);    // 
    LCD_draw_bmp_pixel(0,3,24,I,C);    // 
    LCD_draw_bmp_pixel(0,4,30,I,C);    //
}